== Some random shell/python scripts

Created and intended for my personal use only. Some of these are ancient and most not well maintained, so if anyone stumbles upon this repo: Be warned, read/use at your own risk. :)

'''

=== bedtime-shutdown.sh - üò¥ Digital Detox: Bedtime Enforcer

If you find yourself doom-scrolling or debugging at 02:00 (2 AM), this script is your new best friend (or worst enemy). It forces a system shutdown at a set time every night to make sure you actually get some sleep.

==== How it works

* The Warning: At 22:00 (or whenever you schedule it), the script triggers and sends a "critical" notification to your desktop.
* The Countdown: It gives you a 180-second grace period (customizable) to save your work and close your tabs.
* The End: Once the timer hits zero, it executes a hard `+systemctl poweroff+`. No "just 5 more minutes ..." allowed.

==== üõ†Ô∏è Installation & Setup

Since this script handles system power, we need to set it up with root permissions and a systemd timer.

===== 1. Prep the Script

Copy the script to your local bin:

[source,shell]
----
sudo cp bedtime-shutdown.sh /opt/bin/bedtime-shutdown.sh
----

Open the script and make sure the values in the `+CONFIGURATION+` section fit your personal needs.


NOTE: Make sure that `+USER_NAME+` is set to your actual username (e.g., `+USER_NAME=yourname+`) and the time between `+SHUTDOWN_START+` and `+SHUTDOWN_END+` is your preferred "Bedtime Zone" (e.g., `+SHUTDOWN_START=2200+` and `+SHUTDOWN_END=0500+` to only shutdown between 22:00 to 05:00).

Lock down the permissions so only root can touch it:
[source,shell]
----
sudo chown root:root /opt/bin/bedtime-shutdown.sh
sudo chmod 700 /opt/bin/bedtime-shutdown.sh
----

===== 2. Create the Service

This tells the system what to run.

[source,shell]
----
sudo tee /etc/systemd/system/bedtime.service <<EOF
[Unit]
Description=Bedtime Shutdown Script
[Service]
Type=simple
ExecStart=/opt/bin/bedtime-shutdown.sh
EOF
----

===== 3. Create the Timer

This tells the system when to run it. Default is set to 22:00 (10 PM).

[source,shell]
----
sudo tee /etc/systemd/system/bedtime.timer <<EOF
[Unit]
Description=Run Bedtime Script at 22:00
[Timer]
OnCalendar=--* 22:00:00
Persistent=true

[Install]
WantedBy=timers.target
EOF
----

NOTE: The timer is `+Persistent+`, meaning if your computer is off at the scheduled time, it will run the script as soon as you power it on again. To prevent the system from shutting down immediately after booting up in the morning, make sure the `+SHUTDOWN_START+` and `+SHUTDOWN_END+` times in the script are set correctly.

==== 4. Fire it up

Enable and start the timer:

[source,shell]
----
sudo systemctl enable --now bedtime.timer
----

==== üîí Optional: Advanced Lock-in (PAM)

If you're worried you'll just sudo systemctl stop the timer when the warning pops up, you can use PAM to lock yourself out of authentication starting an hour before bedtime. This prevents new logins and sudo usage during the restricted window.

===== A. Set the time restriction

Add a rule near the end of `+/etc/security/time.conf+` to block user (in this case `youruser`) between 21:00 and 06:00 (9 PM to 6 AM).

[source,shell]
----
sudo tee -a /etc/security/time.conf <<EOF

# Digital Detox: Prevent main user `youruser` from authenticating between 21:00 and 06:00
*; *; youruser; !Al2100-0600
EOF
----

===== B. Enable the PAM module

Edit `+/etc/pam.d/common-account+` and add the following line near tbe beginning to enforce these rules:

....
account    required    pam_time.so
....

WARNING: Be careful with this! If you are not already logged in, you won't be able to get back in until 6 AM.

=== ‚öôÔ∏è Customization

==== Applying Changes to Systemd Units

First of all, whenever either of the `/etc/systemd/system/bedtime.*` files are changed, ensure to reload the systemd daemon and restart the relevant unit(s):

[source,shell]
----
sudo systemctl daemon-reload
# for changes to the timer
sudo systemctl restart bedtime.timer
sudo systemctl status bedtime.timer
# for changes to the service
sudo systemctl restart bedtime.service
sudo systemctl status bedtime.service
----

==== Change the "Bedtime Zone"

* Edit `+SHUTDOWN_START+` and `+SHUTDOWN_END+` in `+/opt/bin/bedtime-shutdown.sh+`.
* Edit `+OnCalendar+` in `+/etc/systemd/system/bedtime.timer+` and reload/restart the timer as shown above.
* _Optional: If PAM time restriction is used, ensure the settings in `+/etc/security/time.conf+` are appropriate for your new "Bedtime Zone"._

==== Change the Grace Period

* Edit `+GRACE_PERIOD+` in `+/opt/bin/bedtime-shutdown.sh+`.

'''

=== nextcloud-maintenance.sh - üîß Nextcloud Maintenance Script

Intended for use in cron with cronic (for info mail) to perform maintenance tasks and integrity/update checks on nextcloud servers, or simply to run before/after an update.

Stuff like:

* `occ db:add-missing-indices`
* `occ maintenance:repair`
* `occ integrity:check-core`
* `occ integrity:check-app "$app"`
* `occ app:update --all --showonly`
* `occ update:check`

'''

=== openvpn-client-cfg.sh

A small openvpn client cretificate and config helper tool

....
Usage:
  openvpn-client-cfg CLIENT_NAME [--ip IP] [--remote HOST] [--routes "NET1/MASK,NET2/MASK"] [--no-split] [--force]
  openvpn-client-cfg --list
  openvpn-client-cfg --delete CLIENT_NAME
  openvpn-client-cfg --revoke CLIENT_NAME

Options:
  --ip IP           Assign static IP via CCD (topology subnet; /24 mask assumed)
  --remote HOST     Override remote host (default: 11001001.org)
  --routes CSV      Extra routes for split-tunnel (e.g. "192.168.1.0/24,10.23.0.0/16")
  --no-split        Do NOT add route-nopull (internet / non-vpn traffic routed through vpn)
  --force|-f        Override safety checks (IP duplicate/subnet/CCD overwrite)

  --list|-l         List CCDs with optional IPs and cert expiry

  --delete|-d NAME  Disable a client by moving CCD to ccd.disabled (no revoke)
  --revoke|-r NAME  Revoke client's cert, refresh CRL, disable CCD

Example:
  # Create a new client configuration named "myworkstation" using static IP 10.10.0.5
  openvpn-client-cfg myworkstation --ip 10.10.0.5

Env overrides:
  EASYRSA_DIR=/home/cbaoth/openvpn-ca
  SERVER_CONF=/etc/openvpn/server/server.conf
  CCD_DIR=/etc/openvpn/ccd
  OUTPUT_DIR=/home/cbaoth
....

'''

=== audio-volume.sh

Toggle mute and change volume using hotkeys within the wm.

'''

=== backup.sh

Backup script with exclusion list, supports full and incremental backups.

'''

=== backup2ftp.sh

Upload last backup (made by backup.sh) to an ftp server, preserve previous backup on ftp.

'''

=== clear-cache.sh

Clean up home folder by removing (known) local caches, temp files etc.

'''

=== dbbackup.sh

Backup script for mysql and postgresql.

'''

=== gallery.sh

Create a very simple image gallery (static html file with static thumbs).

'''

=== pdfprint.sh

Print a pdf/ps file using psnup for multi page per sheet printing.

'''

=== smfetch.sn

Fetch rtmp / http(s) streams from some known (mostly german) tv stations and pages like youtube using wget and rtmpdump.

'''

=== wgetmp.py

Fetch multiple files in parallel using wget.

'''

=== getbyext.sh

Fetch all media files (or specific files by ext.) from a given url using wget.
